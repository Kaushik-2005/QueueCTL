Metadata-Version: 2.4
Name: queuectl
Version: 1.0.0
Summary: CLI Background Job Queue System
Home-page: https://github.com/Kaushik-2005/QueueCTL
Author: Kaushik
Author-email: QueueCTL Team <queuectl@example.com>
License: MIT
Project-URL: Homepage, https://github.com/Kaushik-2005/QueueCTL
Project-URL: Repository, https://github.com/Kaushik-2005/QueueCTL.git
Project-URL: Issues, https://github.com/Kaushik-2005/QueueCTL/issues
Keywords: queue,job,worker,cli,background,task
Classifier: Development Status :: 4 - Beta
Classifier: Environment :: Console
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Classifier: Topic :: System :: Systems Administration
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: typer>=0.9.0
Requires-Dist: rich>=13.0.0
Requires-Dist: click>=8.0.0
Dynamic: author
Dynamic: home-page
Dynamic: requires-python

# QueueCTL - CLI Background Job Queue System

[![Python](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)

A production-quality CLI-based background job queue system that supports multiple workers, retry logic with exponential backoff, and dead letter queue management.

## ğŸš€ Features

- **Job Queue Management**: Enqueue, process, and monitor background jobs
- **Multi-Worker Support**: Run multiple worker processes concurrently
- **Retry Logic**: Exponential backoff for failed jobs with configurable retry limits
- **Dead Letter Queue (DLQ)**: Manage permanently failed jobs with retry and analysis capabilities
- **Persistent Storage**: JSON-based storage that survives system restarts
- **CLI Interface**: Rich command-line interface with colored output and tables
- **Configuration Management**: Configurable system parameters
- **Job Locking**: Prevents race conditions between workers
- **Graceful Shutdown**: Workers finish current jobs before stopping

## ğŸ“¦ Installation & Setup

### Prerequisites

- Python 3.8 or higher
- Git (for cloning the repository)

### Step 1: Clone the Repository

```bash
git clone https://github.com/Kaushik-2005/QueueCTL.git
cd QueueCTL
```

### Step 2: Install Dependencies

```bash
# Install required Python packages
pip install -r requirements.txt
```

**Note**: Due to a naming conflict with Python's built-in `queue` module, we don't use `pip install -e .` for this project.

### Step 3: Set Environment (Required)

**For Windows PowerShell:**
```powershell
$env:PYTHONPATH = "."
```

**For Linux/Mac/WSL:**
```bash
export PYTHONPATH="."
```

### Step 4: Verify Installation

```bash
# Test the CLI interface
python -m cli.main --help

# Run validation tests (recommended)
python tests/test_validation.py

# Run demo to see all features
python demo.py
```

**Expected output**: You should see the CLI help text and all tests should pass.

## ğŸ¯ Quick Start

**Important**: Always set `PYTHONPATH=.` before running commands (see installation steps above).

### 1. Enqueue Your First Job

**Windows PowerShell:**
```powershell
# Simple job
python -m cli.main enqueue "{`"command`": `"echo Hello World`"}"

# Job with custom settings  
python -m cli.main enqueue "{`"id`": `"my-job-1`", `"command`": `"timeout 5`", `"max_retries`": 5}"
```

**Linux/Mac/WSL:**
```bash
# Simple job
python -m cli.main enqueue '{"command": "echo Hello World"}'

# Job with custom settings
python -m cli.main enqueue '{"id": "my-job-1", "command": "sleep 5", "max_retries": 5, "timeout": 30}'
```

### 2. Start Workers

```bash
# Start a single worker
python -m cli.main worker start

# Start multiple workers
python -m cli.main worker start --count 3
```

### 3. Monitor Status

```bash
# Overall system status
python -m cli.main status

# List jobs
python -m cli.main list

# List only pending jobs
python -m cli.main list --state pending
```

### 4. Manage Dead Letter Queue

```bash
# List failed jobs
python -m cli.main dlq list

# Retry a specific job
python -m cli.main dlq retry job-id-here

# Retry all dead jobs
python -m cli.main dlq retry
```

## ğŸ“– Usage Guide

**Remember**: All commands require `PYTHONPATH=.` to be set in your environment.

### Job Management

#### Enqueue Jobs

**Basic Examples:**
```bash
# Basic job
python -m cli.main enqueue '{"command": "python script.py"}'

# Job with full options
python -m cli.main enqueue '{
  "id": "data-processing-job",
  "command": "python process_data.py --input data.csv",
  "max_retries": 3,
  "timeout": 600,
  "priority": 10
}'

# Validate job without enqueuing
python -m cli.main enqueue '{"command": "echo test"}' --validate
```

**PowerShell Note**: Use backtick escaping for JSON:
```powershell
python -m cli.main enqueue "{`"command`": `"echo test`"}"
```

#### List and Monitor Jobs

```bash
# List all jobs
python -m cli.main list

# Filter by state
python -m cli.main list --state pending
python -m cli.main list --state completed
python -m cli.main list --state failed
# Limit results
python -m cli.main list --limit 10

# Detailed view
python -m cli.main list --verbose
```

### Worker Management

#### Start Workers

```bash
# Start single worker in background
python -m cli.main worker start

# Start multiple workers
python -m cli.main worker start --count 5

# Start worker in foreground (for debugging)
python -m cli.main worker start --no-detach
```

#### Stop Workers

```bash
# Graceful shutdown (wait for current jobs)
python -m cli.main worker stop

# Force stop
python -m cli.main worker stop --force

# Custom timeout
python -m cli.main worker stop --timeout 60
```

#### Monitor Workers

```bash
# Worker status
python -m cli.main worker status

# Overall system status
python -m cli.main status

# Force stop
python -m cli.main worker stop --force

# Custom timeout
python -m cli.main worker stop --timeout 60
```

#### Monitor Workers

```bash
```

### Dead Letter Queue (DLQ)

#### List Dead Jobs

```bash
# List all dead jobs
python -m cli.main dlq list

# Detailed view with error analysis
python -m cli.main dlq list --verbose

# Show statistics
python -m cli.main dlq stats
```

#### Retry Failed Jobs

```bash
# Retry specific job
python -m cli.main dlq retry job-id-here

# Retry all dead jobs
python -m cli.main dlq retry

# Retry without resetting attempt count
python -m cli.main dlq retry job-id-here --keep-attempts
```

#### Remove Dead Jobs

```bash
# Remove specific job
python -m cli.main dlq remove job-id-here

# Remove all dead jobs (with confirmation)
python -m cli.main dlq remove

# Skip confirmation
python -m cli.main dlq remove --yes

```

### Configuration

#### View Configuration

```bash
# Show all settings
python -m cli.main config show
```

#### Update Settings

```bash
# Set retry limit
python -m cli.main config set max_retries 5

# Set backoff multiplier
python -m cli.main config set backoff_base 3.0

# Set worker timeout
python -m cli.main config set worker_timeout 600
```

#### Reset Configuration

```bash
# Reset to defaults
python -m cli.main config reset --yes
```

#### Reset Configuration

```bash
# Reset to defaults
python -m cli.main config reset --yes
```

## ğŸ—ï¸ Architecture Overview

### System Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CLI Interface â”‚    â”‚  Job Storage    â”‚    â”‚   Worker Pool   â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ Commands      â”‚â—„â”€â”€â–ºâ”‚ â€¢ JSON Files    â”‚â—„â”€â”€â–ºâ”‚ â€¢ Multiprocess  â”‚
â”‚ â€¢ Validation    â”‚    â”‚ â€¢ File Locking  â”‚    â”‚ â€¢ Job Execution â”‚
â”‚ â€¢ Display       â”‚    â”‚ â€¢ Atomic Ops    â”‚    â”‚ â€¢ Retry Logic   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Configuration  â”‚
                    â”‚                 â”‚
                    â”‚ â€¢ Settings      â”‚
                    â”‚ â€¢ Defaults      â”‚
                    â”‚ â€¢ Validation    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Flow

1. **Job Submission**: Jobs are submitted via CLI and stored in JSON files
2. **Worker Polling**: Workers poll for pending jobs with priority ordering
3. **Job Execution**: Workers execute jobs with timeout and error handling
4. **Retry Logic**: Failed jobs are retried with exponential backoff
5. **DLQ Management**: Jobs exceeding retry limits move to Dead Letter Queue

### Storage Structure

```
~/.queuectl/
â”œâ”€â”€ jobs.json          # All job data
â”œâ”€â”€ locks.json         # Job locks for workers
â”œâ”€â”€ config.json        # System configuration
â””â”€â”€ workers.pid        # Running worker PIDs
```

### Job Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PENDING â”‚â”€â”€â”€â–ºâ”‚ PROCESSING  â”‚â”€â”€â”€â–ºâ”‚ COMPLETED â”‚    â”‚    DEAD     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â–²              â”‚                                      â–²
     â”‚              â–¼                                      â”‚
     â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ FAILED  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     (max retries exceeded)
```

## âš™ï¸ Configuration Options

| Setting | Default | Description |
|---------|---------|-------------|
| `max_retries` | 3 | Maximum retry attempts per job |
| `backoff_base` | 2.0 | Exponential backoff multiplier |
| `worker_timeout` | 300 | Job execution timeout (seconds) |
| `cleanup_completed_after_hours` | 24 | Auto-cleanup completed jobs |
| `job_lock_timeout` | 300 | Job lock expiration (seconds) |
| `max_workers` | 10 | Maximum concurrent workers |

## ğŸ§ª Testing

### Prerequisites
Make sure you have completed the installation steps and set `PYTHONPATH=.` in your environment.

### Run Validation Tests

```bash
# Run all validation tests (recommended first step)
python tests/test_validation.py

# Run comprehensive demo showing all features
python demo.py

# Run specific test modules
python tests/test_basic.py
python tests/test_dlq.py
```

### Manual Testing Scenarios

#### Test Basic Functionality

```bash
# 1. Enqueue a simple job
python -m cli.main enqueue '{"command": "echo Testing QueueCTL"}'

# 2. Start a worker
python -m cli.main worker start

# 3. Check status
python -m cli.main status

# 4. List completed jobs
python -m cli.main list --state completed
```

#### Test Retry Logic

```bash
# 1. Enqueue a failing job
python -m cli.main enqueue '{"command": "nonexistent-command", "max_retries": 2}'

# 2. Start worker
python -m cli.main worker start

# 3. Watch job fail and retry
python -m cli.main list --state failed

# 4. Check DLQ after max retries
python -m cli.main dlq list
```

#### Test Multi-Worker

```bash
# 1. Enqueue multiple jobs
for i in {1..5}; do
  python -m cli.main enqueue "{\"command\": \"sleep $i\"}"
done

# 2. Start multiple workers
python -m cli.main worker start --count 3

# 3. Watch parallel processing
python -m cli.main status
```

### Expected Test Results

- âœ… Jobs are created and stored successfully
- âœ… Workers can process jobs concurrently
- âœ… Failed jobs retry with exponential backoff
- âœ… Jobs exceeding retry limits move to DLQ
- âœ… Data persists across restarts
- âœ… Job locking prevents race conditions
- âœ… Graceful shutdown preserves running jobs

## ğŸ› Troubleshooting

### Common Issues

#### Workers Not Starting

```bash
# Check if workers are already running
python -m cli.main worker status

# Stop existing workers and restart
python -m cli.main worker stop
python -m cli.main worker start
```

#### Jobs Stuck in Processing

```bash
# Check for stale locks
python -m cli.main status

# Restart workers to clear stale locks
python -m cli.main worker stop
python -m cli.main worker start
```

#### Storage Issues

```bash
# Check storage directory
ls -la ~/.queuectl/

# Reset storage (WARNING: deletes all jobs)
rm -rf ~/.queuectl/
```

#### Module Import Errors

If you encounter `ModuleNotFoundError: No module named 'queue'`, ensure:

1. **PYTHONPATH is set correctly:**
   ```bash
   # Linux/macOS
   export PYTHONPATH=.
   
   # Windows PowerShell
   $env:PYTHONPATH="."
   ```

2. **You're running from the project root directory:**
   ```bash
   cd QueueCTL  # Make sure you're in the right directory
   python -m cli.main --help
   ```

3. **Not using pip install (due to naming conflict):**
   - Do NOT run `pip install -e .`
   - Use direct execution with PYTHONPATH instead

### Debug Mode

```bash
# Enable verbose output
export PYTHONPATH=.
python -c "
import logging
logging.basicConfig(level=logging.DEBUG)
from cli.main import main
main()
" status
```

## ğŸš§ Design Decisions & Trade-offs

### Storage Choice: JSON vs Database

**Decision**: JSON files with file locking
**Reasoning**:
- âœ… Zero dependencies (no database setup)
- âœ… Human-readable storage
- âœ… Simple backup/restore
- âŒ Limited scalability vs. database
- âŒ File locking complexity

### Worker Architecture: Multiprocessing vs Threading

**Decision**: Multiprocessing
**Reasoning**:
- âœ… True parallelism for CPU-bound jobs
- âœ… Process isolation (crash safety)
- âœ… Better resource control
- âŒ Higher memory overhead
- âŒ IPC complexity

### CLI Framework: Typer vs Click vs Argparse

**Decision**: Typer with Rich
**Reasoning**:
- âœ… Modern API with type hints
- âœ… Rich output formatting
- âœ… Automatic help generation
- âŒ Additional dependency

## ğŸ›ï¸ Advanced Usage

### Custom Job Processing

```python
# Custom job with Python code
python -m cli.main enqueue '{
  "command": "python -c \"import time; print(\\\"Processing...\\\"); time.sleep(2); print(\\\"Done!\\\")\"",
  "timeout": 10
}'
```

### Batch Operations

```bash
# Enqueue multiple jobs from file
cat jobs.txt | while read cmd; do
  python -m cli.main enqueue "{\"command\": \"$cmd\"}"
done

# Bulk retry all DLQ jobs
python -m cli.main dlq retry
```

### Monitoring & Analytics

```bash
# Job statistics
python -m cli.main dlq stats

# System overview
python -m cli.main status

# Export job data
cat ~/.queuectl/jobs.json | jq '.[] | select(.state == "completed")'
```

## ğŸ”® Future Enhancements

### Planned Features

- [ ] Job scheduling (run_at timestamps)
- [ ] Job dependencies and workflows
- [ ] Web dashboard interface
- [ ] Metrics and monitoring
- [ ] Job output logging
- [ ] Priority queues
- [ ] Job templates
- [ ] Webhook notifications

### Performance Improvements

- [ ] SQLite storage backend option
- [ ] Worker pool optimization
- [ ] Batch job processing
- [ ] Memory usage optimization

## ğŸ¤ Contributing

### Development Setup

```bash
# Clone and setup
git clone https://github.com/Kaushik-2005/QueueCTL.git
cd QueueCTL

# Install in development mode
pip install -e .

# Run tests
python tests/test_validation.py
```

### Code Style

- Follow PEP 8
- Use type hints
- Add docstrings to functions
- Write tests for new features

## ğŸ“„ License

This project is licensed under the MIT License. See [LICENSE](LICENSE) for details.

## ğŸ“ Support

- **Issues**: [GitHub Issues](https://github.com/Kaushik-2005/QueueCTL/issues)
- **Documentation**: This README
- **Email**: queuectl@example.com

---

**QueueCTL** - Making background job processing simple and reliable! ğŸš€
